<div class="store-container min-h-screen w-full bg-neutral-100">

    <!-- TOOLBAR RESPONSIVE -->
    <mat-toolbar 
        color="primary"
        class="nav bg-white shadow-sm border-b border-neutral-200 px-4 py-4 flex items-center">
    
        <div class="w-full flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
        
            <span class="text-neutral-800 font-medium text-lg text-center sm:text-left leading-none">
                CRM Soporte | Presentación de Servicios
            </span>
        
            <button 
                mat-button 
                routerLink="/auth/login"
                class="text-neutral-700 hover:text-black transition flex items-center gap-1 whitespace-nowrap justify-center sm:justify-end leading-none">
                <mat-icon>login</mat-icon>
                Volver al Login
            </button>
        
        </div>
    
    </mat-toolbar>




    <div class="content-wrapper max-w-6xl mx-auto py-10 px-4">

        <h1 class="mat-display-1 text-3xl font-bold text-neutral-800 mb-8">
            Nuestros Paquetes de Soporte Empresarial
        </h1>

        <!-- GRID RESPONSIVE CORREGIDO -->
        <section class="
            packages-grid 
            grid 
            gap-6 
            sm:grid-cols-1 
            md:grid-cols-2 
            lg:grid-cols-3 
            place-items-center
        ">

            @for (pack of packages; track pack) {
                <mat-card 
                    class="package-card bg-white border border-neutral-200 shadow-sm rounded-xl p-4 
                    w-full max-w-sm transition hover:shadow-md"
                    [class.featured]="pack === 'Plan Profesional'">

                    <mat-card-header class="mb-4">
                        <mat-card-title class="text-xl font-semibold text-neutral-800">
                            {{ pack }}
                        </mat-card-title>
                        <mat-card-subtitle class="text-neutral-600">
                            @if (pack === 'Plan Esencial') { Ideal para startups }
                            @else if (pack === 'Plan Profesional') { Máxima eficiencia }
                            @else { Servicios dedicados }
                        </mat-card-subtitle>
                    </mat-card-header>

                    <mat-card-content class="mb-4">
                        <h2 class="price text-2xl font-bold text-blue-600">
                            @switch (pack) {
                                @case ('Plan Esencial') { 99€ / mes }
                                @case ('Plan Profesional') { 299€ / mes }
                                @case ('Plan Corporativo') { 499€ / mes }
                            }
                        </h2>
                    </mat-card-content>

                    <mat-card-actions>
                        <button 
                            mat-raised-button 
                            color="accent" 
                            (click)="selectPackage(pack)"
                            class="bg-blue-500 hover:bg-blue-600 text-white shadow-sm px-4 py-2 rounded-md transition">
                            Solicitar Plan
                        </button>
                    </mat-card-actions>

                </mat-card>
            }

        </section>

        @if (requestForm.get('packageName')?.value) {

            <mat-card class="request-form-card bg-white border border-neutral-200 shadow-md rounded-xl p-6 mt-10">

                <mat-card-header class="mb-4">
                    <mat-card-title class="text-xl font-semibold text-neutral-800">
                        Solicitud del plan: {{ requestForm.get('packageName')?.value }}
                    </mat-card-title>
                </mat-card-header>

                <mat-card-content class="space-y-4">

                    @if (requestStatus === 'success') {
                        <div class="success-message bg-green-100 text-green-700 py-2 px-4 rounded-md border border-green-300">
                            ¡Solicitud enviada! Un manager se pondrá en contacto pronto.
                        </div>
                    }
                    @if (requestStatus === 'error') {
                        <div class="error-message bg-red-100 text-red-700 py-2 px-4 rounded-md border border-red-300">
                            Error al enviar la solicitud. Por favor, inténtalo de nuevo.
                        </div>
                    }

                    <!-- FORMULARIO -->
                    <form 
                        [formGroup]="requestForm" 
                        (ngSubmit)="onSubmitRequest()" 
                        class="request-form-grid grid grid-cols-1 gap-6">

                        <mat-form-field class="full-width w-full">
                            <mat-label>Nombre de la Empresa</mat-label>
                            <input matInput formControlName="companyName" required class="text-neutral-800">
                            @if (requestForm.get('companyName')?.invalid && requestForm.get('companyName')?.touched) {
                                <mat-error class="text-red-600">El nombre de la empresa es obligatorio.</mat-error>
                            }
                        </mat-form-field>

                        <mat-form-field class="full-width w-full">
                            <mat-label>CIF / NIF</mat-label>
                            <input matInput formControlName="cif" required class="text-neutral-800">
                            @if(requestForm.get('cif')?.invalid && requestForm.get('cif')?.touched) {
                                <mat-error class="text-red-600">El CIF/NIF es obligatorio y debe tener entre 9 y 20 caracteres.</mat-error>
                            }
                        </mat-form-field>

                        <mat-form-field class="full-width w-full">
                            <mat-label>Nombre del Contacto</mat-label>
                            <input matInput formControlName="contactName" required class="text-neutral-800">
                            @if(requestForm.get('contactName')?.invalid && requestForm.get('contactName')?.touched) {
                                <mat-error class="text-red-600">El nombre del contacto es obligatorio.</mat-error>
                            }
                        </mat-form-field>

                        <mat-form-field class="full-width w-full">
                            <mat-label>Correo Electrónico</mat-label>
                            <input matInput formControlName="email" type="email" required class="text-neutral-800">
                            @if(requestForm.get('email')?.hasError('required') && requestForm.get('email')?.touched) {
                                <mat-error class="text-red-600">El correo es obligatorio.</mat-error>
                            }
                            @if(requestForm.get('email')?.hasError('email') && requestForm.get('email')?.touched) {
                                <mat-error class="text-red-600">Formato de correo inválido.</mat-error>
                            }
                        </mat-form-field>

                        <mat-form-field class="full-width w-full">
                            <mat-label>Paquete Seleccionado</mat-label>
                            <input matInput formControlName="packageName" [readonly]="true" class="text-neutral-800 bg-neutral-100">
                        </mat-form-field>

                        <mat-form-field class="full-width w-full">
                            <mat-label>Mensaje / Notas adicionales (Opcional)</mat-label>
                            <textarea matInput formControlName="message" rows="3" class="text-neutral-800"></textarea>
                        </mat-form-field>

                        <mat-card-actions class="full-width w-full flex justify-end">
                            <button 
                                mat-raised-button 
                                color="primary" 
                                type="submit" 
                                [disabled]="requestForm.invalid"
                                class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md shadow-sm transition disabled:opacity-50">
                                Enviar Solicitud
                            </button>
                        </mat-card-actions>

                    </form>
                </mat-card-content>
            </mat-card>
        }
    </div>
</div>
